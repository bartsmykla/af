name: "Release"

on:
  push:
    branches: ["master"]
  workflow_dispatch: {}

env:
  PROJECT_NAME: af

jobs:
  build:
    runs-on: ${{ matrix.runner }}

    strategy:
      matrix:
        include:
        - name: "linux-arm64"
          runner: ubuntu-24.04-arm
          target: aarch64-unknown-linux-musl
        - name: "linux-amd64"
          runner: ubuntu-24.04
          target: x86_64-unknown-linux-musl
        - name: "macos-amd64"
          runner: macos-15
          target: x86_64-apple-darwin
        - name: "macos-arm64"
          runner: macos-15
          target: aarch64-apple-darwin

    steps:
    - name: "Checkout"
      uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2

    - name: "Install Rust"
      uses: dtolnay/rust-toolchain@888c2e1ea69ab0d4330cbf0af1ecc7b68f368cc1 # v1
      with:
        targets: ${{ matrix.target }}
        toolchain: stable

    - name: "Setup Cache"
      uses: Swatinem/rust-cache@9d47c6ad4b02e050fd481d890b2ea34778fd09d6 # v2.7.8

    - name: "Build Binary"
      run: cargo build --verbose --locked --release --target ${{ matrix.target }}
